<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>개선된 자격루(물시계) 시뮬레이션</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #fffbf0;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: #fffdf5;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        h1, h2, h3 {
            color: #8B4513;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 5px;
            font-size: 28px;
        }
        
        .subtitle {
            text-align: center;
            color: #8B6914;
            margin-bottom: 20px;
            font-size: 16px;
        }
        
        .info-box {
            background-color: #F9F5E7;
            border-left: 4px solid #D2B48C;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
            background-color: #f9f5e7;
            padding: 15px;
            border-radius: 8px;
        }
        
        .control-group {
            flex: 1;
            min-width: 200px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #8B4513;
        }
        
        select, button {
            width: 100%;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #D2B48C;
            margin-bottom: 10px;
            font-size: 14px;
            background-color: #fff;
        }
        
        button {
            background-color: #8B4513;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
            font-weight: 500;
        }
        
        button:hover {
            background-color: #A0522D;
        }
        
        button:disabled {
            background-color: #D2B48C;
            cursor: not-allowed;
        }
        
        /* 시뮬레이션 영역 스타일 */
        .simulation-container {
            position: relative;
            width: 100%;
            height: 600px;
            margin-bottom: 30px;
            background-color: #F9F5E7;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid #D2B48C;
        }
        
        /* 자격루 전체 구조물 */
        .jagyeongnu-structure {
            position: absolute;
            width: 90%;
            height: 550px;
            left: 5%;
            top: 25px;
        }
        
        /* 윗물통 (큰 물통) */
        .upper-tank {
            position: absolute;
            width: 120px;
            height: 90px;
            left: 50px;
            top: 30px;
            background-color: transparent;
            border: 3px solid #8B4513;
            border-radius: 8px 8px 35% 35%;
            overflow: hidden;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        
        /* 아랫물통 (중간 물통) */
        .middle-tank {
            position: absolute;
            width: 100px;
            height: 70px;
            left: 60px;
            top: 150px;
            background-color: transparent;
            border: 3px solid #8B4513;
            border-radius: 8px 8px 35% 35%;
            overflow: hidden;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        
        /* 아랫물통 (작은 물통) */
        .lower-tank {
            position: absolute;
            width: 80px;
            height: 60px;
            left: 70px;
            top: 250px;
            background-color: transparent;
            border: 3px solid #8B4513;
            border-radius: 8px 8px 35% 35%;
            overflow: hidden;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        
        /* 수위 조절 물통 (원통형) */
        .water-level-regulator {
            position: absolute;
            width: 80px;
            height: 380px;
            left: 260px;
            top: 50px;
            background-color: transparent;
            border: 3px solid #8B4513;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        
        /* 수위 조절 물통 세로 눈금 */
        .regulator-scale {
            position: absolute;
            width: 100%;
            height: 100%;
            left: 0;
            top: 0;
            z-index: 2;
        }
        
        .scale-mark {
            position: absolute;
            width: 10px;
            height: 2px;
            background-color: #8B4513;
            left: 0;
        }
        
        /* 수위 표시자 (빨간 화살표) */
        .water-level-indicator {
            position: absolute;
            width: 20px;
            height: 20px;
            right: -22px;
            background-color: #D2574B;
            clip-path: polygon(0 50%, 100% 0, 100% 100%);
            z-index: 5;
        }
        
        /* 시간 표시 눈금 */
        .time-marks {
            position: absolute;
            width: 20px;
            height: 350px;
            left: 350px;
            top: 65px;
            background-color: #F5DEB3;
            border: 2px solid #8B4513;
            border-radius: 4px;
        }
        
        /* 시간 표시 문구 */
        .time-mark {
            position: absolute;
            width: 100%;
            height: 2px;
            background-color: #8B4513;
        }
        
        .time-label {
            position: absolute;
            right: -45px;
            font-size: 12px;
            color: #8B4513;
            width: 40px;
            text-align: left;
            font-weight: 500;
        }
        
        /* 구슬 */
        .ball {
            position: absolute;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #E6E6FA, #8B8BB9);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            z-index: 5;
        }
        
        /* 구슬 이동 경로 */
        .ball-path {
            position: absolute;
            height: 6px;
            background-color: #D2B48C;
            border-radius: 3px;
            z-index: 2;
        }
        
        /* 종 */
        .bell {
            position: absolute;
            width: 40px;
            height: 45px;
            background-color: #FFD700;
            border-radius: 50% 50% 10% 10%;
            border: 2px solid #B8860B;
            z-index: 6;
            transform-origin: top center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }
        
        .bell-handle {
            position: absolute;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background-color: #FFD700;
            border: 2px solid #B8860B;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .bell-clapper {
            position: absolute;
            width: 6px;
            height: 15px;
            background-color: #B8860B;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 50%;
        }
        
        /* 파이프 */
        .pipe {
            position: absolute;
            background-color: #D2B48C;
            border-radius: 4px;
            z-index: 3;
        }
        
        /* 수수구멍 */
        .regulation-hole {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: white;
            border: 2px solid #8B4513;
            border-radius: 50%;
            z-index: 6;
        }
        
        /* 시간표시판 */
        .time-board {
            position: absolute;
            width: 140px;
            height: 140px;
            right: 120px;
            top: 120px;
            background-color: #F5F5DC;
            border: 3px solid #8B4513;
            border-radius: 10px;
            z-index: 7;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        /* 물 표현 */
        .water {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(to bottom, #a2c7e3, #83B4D6);
            transition: height 0.5s linear;
            z-index: 1;
        }
        
        /* 물결 효과 */
        .water::before {
            content: '';
            position: absolute;
            top: -5px;
            left: 0;
            width: 100%;
            height: 10px;
            background: linear-gradient(to bottom, rgba(255,255,255,0.3), transparent);
            border-radius: 50%;
        }
        
        /* 물방울 */
        .droplet {
            position: absolute;
            width: 8px;
            height: 12px;
            background: radial-gradient(ellipse at 30% 30%, #a2c7e3, #5A99C5);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            z-index: 4;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.1));
        }
        
        /* 구중반 (물 저장소) */
        .water-reservoir {
            position: absolute;
            width: 180px;
            height: 80px;
            right: 100px;
            bottom: 40px;
            background-color: transparent;
            border: 3px solid #8B4513;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        
        /* 파이프 연결 */
        .connector {
            position: absolute;
            width: 80px;
            height: 40px;
            border: 2px solid #D2B48C;
            border-bottom: none;
            border-radius: 40px 40px 0 0;
            z-index: 3;
        }
        
        /* 타이머 표시 */
        .timer-display {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background-color: white;
            padding: 10px 15px;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            font-size: 18px;
            font-weight: bold;
            z-index: 10;
            color: #8B4513;
            border: 1px solid #D2B48C;
        }
        
        /* 실시간 물 흐름 표시 */
        .flow-indicator {
            position: absolute;
            width: 12px;
            height: 12px;
            background-color: rgba(83, 144, 217, 0.7);
            border-radius: 50%;
            animation: flow 1.5s infinite;
            z-index: 10;
        }
        
        @keyframes flow {
            0% {
                opacity: 0;
                transform: scale(0.5);
            }
            50% {
                opacity: 1;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(0.5);
            }
        }
        
        /* 알림 효과 */
        .notification {
            position: absolute;
            width: 40px;
            height: 40px;
            background-color: rgba(255, 215, 0, 0.3);
            border-radius: 50%;
            animation: notify 1s infinite;
            z-index: 5;
        }
        
        @keyframes notify {
            0% {
                transform: scale(0.8);
                opacity: 0.7;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.3;
            }
            100% {
                transform: scale(0.8);
                opacity: 0.7;
            }
        }
        
        /* 벨 울림 효과 */
        @keyframes ring {
            0% { transform: rotate(0); }
            25% { transform: rotate(10deg); }
            50% { transform: rotate(0); }
            75% { transform: rotate(-10deg); }
            100% { transform: rotate(0); }
        }
        
        /* 결과 영역 */
        .results-area {
            background-color: #F9F5E7;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #D2B48C;
        }
        
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 2px solid #D2B48C;
            padding-bottom: 10px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }
        
        th, td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #D2B48C;
        }
        
        th {
            background-color: #F5DEB3;
            font-weight: 500;
            color: #8B4513;
        }
        
        tr:hover {
            background-color: #FFF8E7;
        }
        
        .feedback {
            margin-top: 15px;
            padding: 15px;
            background-color: #F0F8FF;
            border-left: 4px solid #4682B4;
            border-radius: 4px;
        }
        
        /* 설명 영역 */
        .explanation {
            margin-top: 30px;
            background-color: #F9F5E7;
            padding: 25px;
            border-radius: 8px;
            border: 1px solid #D2B48C;
        }
        
        .explanation h3 {
            margin-top: 0;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #D2B48C;
        }
        
        .component-description {
            margin-bottom: 20px;
        }
        
        .component-description h4 {
            color: #8B4513;
            margin-bottom: 8px;
        }
        
        /* 용어 설명 */
        .term {
            font-weight: bold;
            color: #8B4513;
        }
        
        /* 특수 효과: 물 표면 빛 반사 */
        .water-reflection {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 15px;
            background: linear-gradient(to bottom, rgba(255,255,255,0.5), transparent);
            z-index: 2;
        }
        
        /* 반응형 조정 */
        @media (max-width: 768px) {
            .simulation-container {
                height: 700px;
            }
            
            .jagyeongnu-structure {
                transform: scale(0.8);
                transform-origin: center top;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>개선된 자격루(물시계) 원리 시뮬레이션</h1>
        <div class="subtitle">2022 개정 교육과정 | 과학탐구실험 | 단원: 우리 선조들의 과학과 기술</div>
        
        <div class="info-box">
            <strong>성취기준:</strong> 2022 개정 교육과정 과학탐구실험 "우리 선조들의 과학 기술의 발달 과정과 원리를 탐구하고, 그 과학적 원리를 설명한다."<br>
            <strong>실험 목표:</strong> 자격루(물시계)의 구조와 작동 원리를 이해하고, 수위 조절 구멍 유무가 시간 측정의 정확성에 미치는 영향을 비교한다.
        </div>
        
        <div class="controls">
            <div class="control-group">
                <label for="water-amount">물의 양:</label>
                <select id="water-amount">
                    <option value="80">80눈금</option>
                    <option value="100" selected>100눈금</option>
                    <option value="120">120눈금</option>
                </select>
            </div>
            <div class="control-group">
                <label for="hole-toggle">수위 조절 구멍:</label>
                <select id="hole-toggle">
                    <option value="true" selected>있음</option>
                    <option value="false">없음</option>
                </select>
            </div>
            <div class="control-group">
                <label for="flow-rate">물 흐름 속도:</label>
                <select id="flow-rate">
                    <option value="slow">느림</option>
                    <option value="medium" selected>중간</option>
                    <option value="fast">빠름</option>
                </select>
            </div>
            <div class="control-group">
                <button id="start-btn">측정 시작</button>
                <button id="reset-btn">다시 실험하기</button>
                <button id="clear-btn">결과 초기화</button>
            </div>
        </div>
        
        <div class="simulation-container" id="simulation-container">
            <!-- 자격루 전체 구조 -->
            <div class="jagyeongnu-structure">
                <!-- 윗 파수호 (큰 물통) -->
                <div class="upper-tank">
                    <div class="water" id="upper-water" style="height: 70%;"></div>
                    <div class="water-reflection"></div>
                </div>
                <span style="position: absolute; top: 10px; left: 20px; font-size: 14px; font-weight: 500; color: #8B4513;">윗 파수호</span>
                
                <!-- 중간 파수호 -->
                <div class="middle-tank">
                    <div class="water" id="middle-water" style="height: 40%;"></div>
                    <div class="water-reflection"></div>
                </div>
                <span style="position: absolute; top: 130px; left: 30px; font-size: 14px; font-weight: 500; color: #8B4513;">중간 파수호</span>
                
                <!-- 아랫 파수호 -->
                <div class="lower-tank">
                    <div class="water" id="lower-water" style="height: 30%;"></div>
                    <div class="water-reflection"></div>
                </div>
                <span style="position: absolute; top: 230px; left: 40px; font-size: 14px; font-weight: 500; color: #8B4513;">아랫 파수호</span>
                
                <!-- 수위 조절 물통 (시각늠대) - 안에 시각 눈금 포함 -->
                <div class="water-level-regulator">
                    <div class="water" id="regulator-water" style="height: 60%;"></div>
                    <div class="water-level-indicator" style="top: 40%;"></div>
                    <div class="water-reflection"></div>
                    
                    <!-- 수위 조절 구멍 -->
                    <div class="regulation-hole" id="regulation-hole" style="right: -6px; top: 70%;"></div>
                    
                    <!-- 세로 눈금 -->
                    <div class="regulator-scale" id="regulator-scale"></div>
                </div>
                
                <!-- 시각 눈금 (시각늠대 옆에 독립적으로 배치) -->
                <div class="time-marks" id="time-marks" style="position: absolute; left: 390px; top: 50px; background-color: #F5DEB3; border: 2px solid #8B4513; border-radius: 4px;"></div>
                
                <span style="position: absolute; top: 20px; left: 260px; font-size: 14px; font-weight: 500; color: #8B4513;">시각늠대</span>
                <span style="position: absolute; top: 20px; left: 390px; font-size: 14px; font-weight: 500; color: #8B4513;">시각눈금</span>
                
                <!-- 파이프 연결 (윗 파수호 -> 중간 파수호) -->
                <div class="pipe" style="width: 8px; height: 30px; left: 106px; top: 120px;"></div>
                
                <!-- 파이프 연결 (중간 파수호 -> 아랫 파수호) -->
                <div class="pipe" style="width: 8px; height: 30px; left: 106px; top: 220px;"></div>
                
                <!-- 파이프 연결 (아랫 파수호 -> 시각늠대) -->
                <div class="pipe" style="width: 90px; height: 8px; left: 150px; top: 280px;"></div>
                <div class="pipe" style="width: 8px; height: 70px; left: 240px; top: 210px;"></div>
                <div class="pipe" style="width: 20px; height: 8px; left: 240px; top: 210px;"></div>
                
                <!-- 구슬 경로 (수평 연결) -->
                <div class="connector" style="left: 320px; top: 120px;"></div>
                
                <!-- 구슬 이동 경로 -->
                <div class="ball-path" style="width: 150px; top: 160px; left: 370px;"></div>
                
                <!-- 종 -->
                <div class="bell" style="right: 180px; top: 140px;" id="bell-hour">
                    <div class="bell-handle"></div>
                    <div class="bell-clapper"></div>
                </div>
                <span style="position: absolute; top: 120px; right: 155px; font-size: 14px; font-weight: 500; color: #8B4513;">종</span>
                
                <!-- 북 -->
                <div class="bell" style="right: 180px; top: 220px; border-radius: 10%; background-color: #CD853F;" id="bell-quarter">
                    <div class="bell-handle" style="background-color: #CD853F; border-color: #8B4513;"></div>
                </div>
                <span style="position: absolute; top: 200px; right: 155px; font-size: 14px; font-weight: 500; color: #8B4513;">북</span>
                
                <!-- 징 -->
                <div class="bell" style="right: 180px; top: 300px; height: 35px; border-radius: 50%; background-color: #D3D3D3; border-color: #696969;" id="bell-minute">
                    <div class="bell-handle" style="background-color: #D3D3D3; border-color: #696969;"></div>
                </div>
                <span style="position: absolute; top: 280px; right: 155px; font-size: 14px; font-weight: 500; color: #8B4513;">징</span>
                
                <!-- 구슬들 -->
                <div class="ball" id="ball1" style="left: 400px; top: 152px;"></div>
                <div class="ball" id="ball2" style="left: 430px; top: 152px;"></div>
                <div class="ball" id="ball3" style="left: 460px; top: 152px;"></div>
                
                <!-- 물 흐름 표시 -->
                <div class="flow-indicator" id="flow1" style="left: 110px; top: 125px;"></div>
                <div class="flow-indicator" id="flow2" style="left: 110px; top: 225px;"></div>
                <div class="flow-indicator" id="flow3" style="left: 180px; top: 280px;"></div>
                <div class="flow-indicator" id="flow4" style="left: 244px; top: 250px;"></div>
                
                <!-- 물 저장소 (구중반) -->
                <div class="water-reservoir">
                    <div class="water" id="reservoir-water" style="height: 20%;"></div>
                    <div class="water-reflection"></div>
                </div>
                <span style="position: absolute; bottom: 125px; right: 165px; font-size: 14px; font-weight: 500; color: #8B4513;">구중반</span>
                
                <!-- 시간 표시판 위치 조정 - 훨씬 더 오른쪽으로 이동 -->
                <div class="time-board" style="position: absolute; right: auto; left: 500px; top: 180px; width: 100px; height: 100px; z-index: 5;">
                    <div style="font-size: 14px; font-weight: bold; margin-bottom: 10px; color: #8B4513;">현재 시각</div>
                    <div id="current-time" style="font-size: 24px; font-weight: bold; color: #8B4513;">자시</div>
                </div>
                
                <!-- 타이머 표시 -->
                <div class="timer-display">
                    경과 시간: <span id="timer">0.0</span>시
                </div>
            </div>
        </div>
        
        <div class="results-area">
            <div class="results-header">
                <h3>측정 결과</h3>
                <div>실험 조건과 결과를 비교해보세요.</div>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>실험 회차</th>
                        <th>물의 양</th>
                        <th>수위 조절 구멍</th>
                        <th>물 흐름 속도</th>
                        <th>12시각 도달 시간</th>
                        <th>오차율</th>
                    </tr>
                </thead>
                <tbody id="results-body">
                    <!-- 결과가 여기에 추가됩니다 -->
                </tbody>
            </table>
            
            <div id="feedback" class="feedback" style="display: none;">
                <div id="feedback-text"></div>
            </div>
        </div>
        
        <div class="explanation">
            <h3>자격루(물시계)의 구조와 과학적 원리</h3>
            
            <div class="component-description">
                <h4>자격루의 역사와 의의</h4>
                <p>자격루(물시계)는 고려시대와 조선시대에 사용된 정교한 시간 측정 장치로, 특히 조선 세종대왕 때 발전된 '자격루(自擊漏)'는 물의 흐름을 이용해 자동으로 시간을 알리는 혁신적인 기술이었습니다. 현재 국보 제229호로 지정된 이 물시계는 당시 동아시아에서 가장 정교한 시간 측정 기구였습니다.</p>
            </div>
            
            <div class="component-description">
                <h4>자격루의 주요 구성 요소</h4>
                <ul>
                    <li><span class="term">파수호(윗물통, 중간물통, 아랫물통)</span>: 물을 담고 일정한 속도로 흘려보내는 물통 시스템입니다.</li>
                    <li><span class="term">시각늠대(수위 조절 물통)</span>: 일정한 수위를 유지하여 수압을 조절하고, 이를 통해 정확한 시간 측정을 가능하게 합니다.</li>
                    <li><span class="term">구슬 장치</span>: 물의 흐름에 따라 구슬이 움직이며 종, 북, 징을 울려 시간을 알립니다.</li>
                    <li><span class="term">수수구멍(수위 조절 구멍)</span>: 시각늠대에 있는 구멍으로, 물이 일정 수위에 도달하면 넘치게 하여 수위를 일정하게 유지하는 역할을 합니다.</li>
                    <li><span class="term">구중반(물 저장소)</span>: 사용된 물이 최종적으로 모이는 곳입니다.</li>
                </ul>
            </div>
            
            <div class="component-description">
                <h4>자격루의 과학적 원리</h4>
                <p>자격루는 다음과 같은 과학적 원리를 활용합니다:</p>
                <ol>
                    <li><strong>유체역학의 원리</strong>: 수압과 유량의 관계를 이용하여 시간을 측정합니다.</li>
                    <li><strong>수위 일정 유지 원리</strong>: 수수구멍을 통해 물의 수위를 일정하게 유지함으로써 일정한 수압을 확보합니다.</li>
                    <li><strong>기계적 연동 장치</strong>: 물의 흐름에 따라 구슬이 움직이고, 이에 따라 종, 북, 징을 자동으로 울려 시간을 알립니다.</li>
                </ol>
                <p>특히 중요한 과학적 원리는 다음과 같습니다:</p>
                <ul>
                    <li><strong>수위 조절 구멍이 있을 때:</strong> 수위 조절 물통 내부의 수위가 일정하게 유지되어 항상 같은 수압으로 물이 흘러나옵니다. 따라서 시간 측정이 정확합니다.</li>
                    <li><strong>수위 조절 구멍이 없을 때:</strong> 물통의 수위가 점점 낮아지면서 수압이 감소합니다. 이로 인해 시간이 지날수록 물이 더 천천히 흘러나오게 되어 시간 측정에 오차가 발생합니다.</li>
                </ul>
            </div>
            
            <div class="component-description">
                <h4>현대적 의의</h4>
                <p>자격루의 원리는 현대 자동 제어 시스템이나 피드백 제어 메커니즘과 유사한 면이 있습니다. 수위를 일정하게 유지하기 위한 수수구멍의 역할은 일종의 피드백 제어 장치로, 오늘날 자동화 시스템에서 볼 수 있는 기본 원리와 맞닿아 있습니다. 이처럼 우리 조상들은 현대 과학기술의 기초가 되는 원리를 이미 활용하고 있었습니다.</p>
            </div>
        </div>
    </div>

        <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM 요소 가져오기
            const waterAmountSelect = document.getElementById('water-amount');
            const holeToggleSelect = document.getElementById('hole-toggle');
            const flowRateSelect = document.getElementById('flow-rate');
            const startBtn = document.getElementById('start-btn');
            const resetBtn = document.getElementById('reset-btn');
            const clearBtn = document.getElementById('clear-btn');
            const timerElement = document.getElementById('timer');
            const currentTimeElement = document.getElementById('current-time');
            const resultsBody = document.getElementById('results-body');
            const feedbackContainer = document.getElementById('feedback');
            const feedbackText = document.getElementById('feedback-text');
            
            // 물통 요소들
            const upperWater = document.getElementById('upper-water');
            const middleWater = document.getElementById('middle-water');
            const lowerWater = document.getElementById('lower-water');
            const regulatorWater = document.getElementById('regulator-water');
            const reservoirWater = document.getElementById('reservoir-water');
            const regulationHole = document.getElementById('regulation-hole');
            const waterLevelIndicator = document.querySelector('.water-level-indicator');
            const timeMarks = document.getElementById('time-marks');
            const regulatorScale = document.getElementById('regulator-scale');
            
            // 구슬과 종 요소들
            const balls = [
                document.getElementById('ball1'),
                document.getElementById('ball2'),
                document.getElementById('ball3')
            ];
            
            const bells = [
                document.getElementById('bell-hour'),
                document.getElementById('bell-quarter'),
                document.getElementById('bell-minute')
            ];
            
            // 변수 초기화
            let isRunning = false;
            let startTime;
            let timerInterval;
            let experimentCount = 0;
            let results = [];
            const jagyeongTimes = ['자(子)시', '축(丑)시', '인(寅)시', '묘(卯)시', '진(辰)시', '사(巳)시', 
                                 '오(午)시', '미(未)시', '신(申)시', '유(酉)시', '술(戌)시', '해(亥)시'];
            let currentTimeIndex = 0;
            let dropInterval;
            let ballInterval;
            let bellInterval;
            let waterLevelInterval;
            
            // 시간 마커 생성
            function createTimeMarkers() {
                timeMarks.innerHTML = '';
                const markerHeight = 320; // 마커 전체 높이
                
                for (let i = 0; i < 12; i++) {
                    const marker = document.createElement('div');
                    marker.className = 'time-mark';
                    marker.style.top = (i * (markerHeight / 11) + 15) + 'px';
                    
                    const label = document.createElement('div');
                    label.className = 'time-label';
                    label.textContent = jagyeongTimes[11-i];
                    label.style.top = '-8px';
                    
                    marker.appendChild(label);
                    timeMarks.appendChild(marker);
                }
            }
            
            // 수위 조절 물통의 눈금 생성
            function createRegulatorScale() {
                regulatorScale.innerHTML = '';
                const scaleHeight = 350; // 눈금 전체 높이
                
                for (let i = 0; i <= 10; i++) {
                    const marker = document.createElement('div');
                    marker.className = 'scale-mark';
                    marker.style.top = (i * (scaleHeight / 10) + 15) + 'px';
                    
                    if (i % 5 === 0) {
                        marker.style.width = '15px';
                        marker.style.height = '3px';
                        marker.style.backgroundColor = '#5D4037';
                        
                        const label = document.createElement('div');
                        label.style.position = 'absolute';
                        label.style.left = '20px';
                        label.style.top = '-8px';
                        label.style.fontSize = '10px';
                        label.style.color = '#5D4037';
                        label.textContent = (10 - i) * 10;
                        
                        marker.appendChild(label);
                    }
                    
                    regulatorScale.appendChild(marker);
                }
            }
            
            // 물방울 생성
            function createDroplet(startX, startY, endX, endY) {
                const droplet = document.createElement('div');
                droplet.className = 'droplet';
                droplet.style.left = startX + 'px';
                droplet.style.top = startY + 'px';
                document.querySelector('.jagyeongnu-structure').appendChild(droplet);
                
                // 애니메이션
                setTimeout(() => {
                    droplet.style.opacity = '1';
                    droplet.style.transition = 'transform 1.5s linear, opacity 0.3s ease-in';
                    droplet.style.transform = `translate(${endX - startX}px, ${endY - startY}px)`;
                    
                    // 제거
                    setTimeout(() => {
                        droplet.style.opacity = '0';
                        setTimeout(() => {
                            droplet.remove();
                        }, 300);
                    }, 1500);
                }, 10);
            }
            
            // 물방울 애니메이션 시작
            function startDropletAnimation() {
                const flowSpeed = getFlowSpeed();
                const interval = 2000 / flowSpeed;
                
                // 윗 파수호에서 중간 파수호로
                dropInterval = setInterval(() => {
                    // 윗 파수호 -> 중간 파수호
                    createDroplet(106, 110, 106, 140);
                    
                    // 중간 파수호 -> 아랫 파수호
                    setTimeout(() => {
                        createDroplet(106, 210, 106, 240);
                    }, interval / 3);
                    
                    // 아랫 파수호 -> 시각늠대
                    setTimeout(() => {
                        createDroplet(150, 280, 240, 280);
                        setTimeout(() => {
                            createDroplet(240, 280, 240, 220);
                        }, 300);
                    }, interval / 2);
                    
                    // 시각늠대 -> 구중반
                    setTimeout(() => {
                        if (regulationHole.style.display !== 'none') {
                            createDroplet(260, 280, 290, 310);
                            setTimeout(() => {
                                createDroplet(290, 310, 350, 400);
                            }, 300);
                        }
                    }, interval / 1.5);
                    
                }, interval);
            }
            
            // 벨 애니메이션
            function animateBell(bellIndex) {
                const bell = bells[bellIndex];
                bell.style.animation = 'ring 0.5s ease-in-out';
                
                // 알림 효과
                const notification = document.createElement('div');
                notification.className = 'notification';
                notification.style.left = bell.style.left;
                notification.style.top = bell.style.top;
                document.querySelector('.jagyeongnu-structure').appendChild(notification);
                
                // 제거
                setTimeout(() => {
                    bell.style.animation = '';
                    notification.remove();
                }, 1000);
            }
            
            // 구슬 애니메이션
            function animateBalls() {
                const flowSpeed = getFlowSpeed();
                let ballIndex = 0;
                
                ballInterval = setInterval(() => {
                    const ball = balls[ballIndex];
                    ball.style.transition = 'transform 2s ease-in-out';
                    ball.style.transform = 'translateX(70px)';
                    
                    // 종 울림
                    setTimeout(() => {
                        animateBell(ballIndex);
                    }, 1500);
                    
                    // 구슬 원위치
                    setTimeout(() => {
                        ball.style.opacity = '0';
                        
                        setTimeout(() => {
                            ball.style.transition = 'none';
                            ball.style.transform = 'translateX(0)';
                            
                            setTimeout(() => {
                                ball.style.opacity = '1';
                            }, 200);
                        }, 1000);
                    }, 2000);
                    
                    // 다음 구슬
                    ballIndex = (ballIndex + 1) % balls.length;
                }, 12000 / flowSpeed);
            }
            
            // 시각 업데이트
            function updateTime(elapsedTime) {
                // 12시간을 12로 나누어 각 시각 범위 계산
                const timePerHour = 12 / 12; // 시간당 1시간
                const currentIndex = Math.floor(elapsedTime / timePerHour);
                
                // 인덱스가 범위를 벗어나지 않도록 조정
                const safeIndex = Math.min(currentIndex, 11);
                
                if (safeIndex !== currentTimeIndex) {
                    currentTimeIndex = safeIndex;
                    currentTimeElement.textContent = jagyeongTimes[currentTimeIndex];
                    
                    // 시간이 바뀔 때 종 울림
                    animateBell(0);
                    
                    // 시각 표시 하이라이트
                    highlightTimeMark(currentTimeIndex);
                }
                
                // 수위 표시자 업데이트 - 시각늠대에 표시
                const totalHeight = 320;
                const progressRatio = elapsedTime / 12; // 0~1 사이 진행률
                // 위에서부터 아래로 내려가는 방식으로 계산 (역순)
                const newTop = 30 + totalHeight * (1 - progressRatio);
                waterLevelIndicator.style.top = newTop + 'px';
            }
            
            // 시각 눈금 하이라이트
            function highlightTimeMark(index) {
                // 기존 하이라이트 제거
                const marks = timeMarks.querySelectorAll('.time-mark');
                marks.forEach(mark => {
                    mark.style.backgroundColor = '#8B4513';
                    mark.style.height = '2px';
                    const label = mark.querySelector('.time-label');
                    if (label) {
                        label.style.fontWeight = '500';
                        label.style.color = '#8B4513';
                    }
                });
                
                // 현재 시각 하이라이트 (역순으로 계산: 11-index)
                const currentMark = marks[11-index];
                if (currentMark) {
                    currentMark.style.backgroundColor = '#E91E63';
                    currentMark.style.height = '3px';
                    const label = currentMark.querySelector('.time-label');
                    if (label) {
                        label.style.fontWeight = 'bold';
                        label.style.color = '#E91E63';
                    }
                }
            }
            
            // 물 수위 업데이트
            function updateWaterLevels() {
                const hasHole = holeToggleSelect.value === 'true';
                const waterAmount = parseInt(waterAmountSelect.value);
                const flowSpeed = getFlowSpeed();
                
                // 초기 수위 설정
                const initialUpperHeight = waterAmount === 80 ? 60 : (waterAmount === 100 ? 80 : 95);
                const initialMiddleHeight = 40;
                const initialLowerHeight = 30;
                const initialRegulatorHeight = 60;
                
                upperWater.style.height = initialUpperHeight + '%';
                middleWater.style.height = initialMiddleHeight + '%';
                lowerWater.style.height = initialLowerHeight + '%';
                regulatorWater.style.height = initialRegulatorHeight + '%';
                
                // 시간에 따른 수위 변화
                waterLevelInterval = setInterval(() => {
                    // 현재 수위 가져오기
                    let upperHeight = parseFloat(upperWater.style.height);
                    let middleHeight = parseFloat(middleWater.style.height);
                    let lowerHeight = parseFloat(lowerWater.style.height);
                    let regulatorHeight = parseFloat(regulatorWater.style.height);
                    let reservoirHeight = parseFloat(reservoirWater.style.height) || 20;
                    
                    // 수위 변화율 (흐름 속도에 따라)
                    const decreaseRate = 0.2 * flowSpeed;
                    const increaseRate = 0.15 * flowSpeed;
                    
                    // 윗 파수호 수위 감소
                    upperHeight = Math.max(0, upperHeight - decreaseRate);
                    upperWater.style.height = upperHeight + '%';
                    
                    // 중간 파수호 - 유입되는 물과 유출되는 물의 균형
                    if (upperHeight > 0) {
                        middleHeight = Math.min(80, middleHeight + (increaseRate * 0.5));
                    } else {
                        middleHeight = Math.max(0, middleHeight - decreaseRate);
                    }
                    middleWater.style.height = middleHeight + '%';
                    
                    // 아랫 파수호 - 유입되는 물과 유출되는 물의 균형
                    if (middleHeight > 0) {
                        lowerHeight = Math.min(80, lowerHeight + (increaseRate * 0.4));
                    } else {
                        lowerHeight = Math.max(0, lowerHeight - decreaseRate);
                    }
                    lowerWater.style.height = lowerHeight + '%';
                    
                    // 시각늠대 수위
                    if (lowerHeight > 0) {
                        if (hasHole) {
                            // 수위 조절 구멍이 있으면 일정 수위 유지
                            const holePosition = parseFloat(regulationHole.style.top) || 70;
                            if (regulatorHeight < holePosition) {
                                regulatorHeight = Math.min(holePosition, regulatorHeight + (increaseRate * 0.3));
                            } else {
                                regulatorHeight = holePosition;
                            }
                        } else {
                            // 수위 조절 구멍이 없으면 계속 상승
                            regulatorHeight = Math.min(95, regulatorHeight + (increaseRate * 0.3));
                        }
                    }
                    regulatorWater.style.height = regulatorHeight + '%';
                    
                    // 구중반 수위 상승
                    reservoirHeight = Math.min(90, reservoirHeight + (increaseRate * 0.1));
                    reservoirWater.style.height = reservoirHeight + '%';
                    
                }, 100);
            }
            
            // 흐름 속도 가져오기
            function getFlowSpeed() {
                const flowRate = flowRateSelect.value;
                return flowRate === 'slow' ? 0.5 : (flowRate === 'medium' ? 1 : 2);
            }
            
            // 실험 시작
            function startExperiment() {
                if (isRunning) return;
                
                isRunning = true;
                experimentCount++;
                
                // 버튼 상태 변경
                startBtn.disabled = true;
                resetBtn.disabled = false;
                waterAmountSelect.disabled = true;
                holeToggleSelect.disabled = true;
                flowRateSelect.disabled = true;
                
                // 타이머 시작
                startTime = new Date();
                updateTimer();
                timerInterval = setInterval(updateTimer, 100);
                
                // 애니메이션 시작
                startDropletAnimation();
                animateBalls();
                updateWaterLevels();
                
                // 피드백 숨기기
                feedbackContainer.style.display = 'none';
            }
            
            // 타이머 업데이트
            function updateTimer() {
                const now = new Date();
                const elapsed = (now - startTime) / 1000; // 초 단위
                
                // 1초당 0.1시간으로 계산 (12시간을 120초)
                const simulatedHours = elapsed / 10;
                timerElement.textContent = simulatedHours.toFixed(1);
                
                // 시각 업데이트
                updateTime(simulatedHours);
                
                // 12시간이 지나면 자동 종료
                if (simulatedHours >= 12) {
                    stopExperiment();
                    showResults(simulatedHours);
                }
            }
            
            // 실험 중지
            function stopExperiment() {
                if (!isRunning) return;
                
                isRunning = false;
                
                // 타이머 중지
                clearInterval(timerInterval);
                
                // 애니메이션 중지
                clearInterval(dropInterval);
                clearInterval(ballInterval);
                clearInterval(waterLevelInterval);
                
                // 버튼 상태 변경
                startBtn.disabled = false;
                resetBtn.disabled = true;
                waterAmountSelect.disabled = false;
                holeToggleSelect.disabled = false;
                flowRateSelect.disabled = false;
            }
            
            // 결과 표시
            function showResults(totalTime) {
                const waterAmount = parseInt(waterAmountSelect.value);
                const hasHole = holeToggleSelect.value === 'true';
                const flowRate = flowRateSelect.options[flowRateSelect.selectedIndex].text;
                
                // 이상적인 시간 (12시간)
                const idealTime = 12;
                
                // 오차율 계산 (%)
                const errorRate = Math.abs((totalTime - idealTime) / idealTime * 100).toFixed(2);
                
                // 결과 저장
                const result = {
                    count: experimentCount,
                    waterAmount: waterAmount,
                    hasHole: hasHole,
                    flowRate: flowRate,
                    time: totalTime.toFixed(1),
                    errorRate: errorRate
                };
                
                results.push(result);
                
                // 결과 표에 추가
                const row = resultsBody.insertRow();
                row.insertCell(0).textContent = result.count;
                row.insertCell(1).textContent = result.waterAmount + '눈금';
                row.insertCell(2).textContent = result.hasHole ? '있음' : '없음';
                row.insertCell(3).textContent = result.flowRate;
                row.insertCell(4).textContent = result.time + '시';
                row.insertCell(5).textContent = result.errorRate + '%';
                
                // 결과 분석 및 피드백
                analyzeFeedback();
            }
            
            // 결과 분석 및 피드백
            function analyzeFeedback() {
                if (results.length < 2) return;
                
                // 수위 조절 구멍 유무에 따른 결과 비교
                const withHoleResults = results.filter(r => r.hasHole);
                const withoutHoleResults = results.filter(r => !r.hasHole);
                
                if (withHoleResults.length > 0 && withoutHoleResults.length > 0) {
                    // 평균 오차율 계산
                    const avgErrorWithHole = withHoleResults.reduce((sum, r) => sum + parseFloat(r.errorRate), 0) / withHoleResults.length;
                    const avgErrorWithoutHole = withoutHoleResults.reduce((sum, r) => sum + parseFloat(r.errorRate), 0) / withoutHoleResults.length;
                    
                    // 피드백 메시지
                    let message = '<strong>실험 분석:</strong><br>';
                    message += `수위 조절 구멍이 있을 때 평균 오차율: <strong>${avgErrorWithHole.toFixed(2)}%</strong><br>`;
                    message += `수위 조절 구멍이 없을 때 평균 오차율: <strong>${avgErrorWithoutHole.toFixed(2)}%</strong><br><br>`;
                    
                    if (avgErrorWithHole < avgErrorWithoutHole) {
                        message += '결과적으로 <strong>수위 조절 구멍이 있을 때</strong> 시간 측정이 더 정확함을 알 수 있습니다. 이는 수위 조절 구멍이 일정한 수압을 유지하여 물이 일정한 속도로 흘러나오게 하기 때문입니다.';
                    } else {
                        message += '일반적으로는 수위 조절 구멍이 있을 때 더 정확한 결과가 나와야 합니다. 다양한 조건에서 더 많은 실험을 진행해보세요.';
                    }
                    
                    feedbackText.innerHTML = message;
                    feedbackContainer.style.display = 'block';
                }
            }
            
            // 실험 초기화
            function resetExperiment() {
                stopExperiment();
                
                // 수위 초기화
                const waterAmount = parseInt(waterAmountSelect.value);
                const height = waterAmount === 80 ? '60%' : (waterAmount === 100 ? '80%' : '95%');
                
                upperWater.style.height = height;
                middleWater.style.height = '40%';
                lowerWater.style.height = '30%';
                regulatorWater.style.height = '60%';
                reservoirWater.style.height = '20%';
                
                // 타이머 초기화
                timerElement.textContent = '0.0';
                
                // 시각 초기화
                currentTimeIndex = 0;
                currentTimeElement.textContent = jagyeongTimes[0];
                
                // 수위 표시자 위치 초기화
                waterLevelIndicator.style.top = '40%';
            }
            
            // 결과 초기화
            function clearResults() {
                results = [];
                resultsBody.innerHTML = '';
                experimentCount = 0;
                feedbackContainer.style.display = 'none';
            }
            
            // 초기화
            function init() {
                createTimeMarkers();
                createRegulatorScale();
                updateHoleStatus();
                resetBtn.disabled = true;
            }
            
            // 구멍 상태 업데이트
            function updateHoleStatus() {
                const hasHole = holeToggleSelect.value === 'true';
                regulationHole.style.display = hasHole ? 'block' : 'none';
            }
            
            // 이벤트 리스너
            startBtn.addEventListener('click', startExperiment);
            resetBtn.addEventListener('click', resetExperiment);
            clearBtn.addEventListener('click', clearResults);
            holeToggleSelect.addEventListener('change', updateHoleStatus);
            
            // 시작!
            init();
        });
    </script>
</body>
</html>
